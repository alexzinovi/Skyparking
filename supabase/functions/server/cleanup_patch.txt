// TEMPORARY FILE - Enhanced cleanup section

for (const user of invalidUsers) {
  try {
    console.log(`ğŸ—‘ï¸ Attempting to delete user ${user.id} (username: "${user.username}")...`);
    
    // Verify user exists before deletion
    const existingUser = await kv.get(`user:${user.id}`);
    if (!existingUser) {
      console.log(`âš ï¸ User ${user.id} does not exist in KV store`);
      failedUsers.push({ id: user.id, username: user.username, reason: "Not found in store" });
      failCount++;
      continue;
    }
    
    // Force delete from KV store without validation
    await kv.del(`user:${user.id}`);
    console.log(`âœ… Deleted user:${user.id}`);
    
    // Try to delete username mapping if it exists
    if (user.username && user.username.trim() !== '') {
      const usernameMapping = await kv.get(`username:${user.username}`);
      if (usernameMapping) {
        await kv.del(`username:${user.username}`);
        console.log(`âœ… Deleted username mapping: username:${user.username}`);
      }
    }
    
    // Verify deletion
    const verifyUser = await kv.get(`user:${user.id}`);
    if (verifyUser) {
      console.log(`âŒ User ${user.id} still exists after deletion!`);
      failedUsers.push({ id: user.id, username: user.username, reason: "Still exists after delete" });
      failCount++;
    } else {
      console.log(`âœ… Successfully deleted and verified user ${user.id}`);
      deletedUsers.push({ id: user.id, username: user.username });
      successCount++;
    }
  } catch (error) {
    console.log(`âŒ Failed to delete invalid user ${user.id}:`, error);
    failedUsers.push({ id: user.id, username: user.username, reason: String(error) });
    failCount++;
  }
}
